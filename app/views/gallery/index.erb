<% num_albums_at_once = 14 %>

<script type = "text/javascript">
  function set_button_states() {
    if (first_photo == 1) {
      $('#previous img').attr('src', $('#previous img').attr('src').replace('arrow_left.png', 'arrow_left_ghosted.png'));
    } else {
      $('#previous img').attr('src', $('#previous img').attr('src').replace('_ghosted', ''));
    }

    if (last_photo == album_size) {
      $('#next img').attr('src', $('#next img').attr('src').replace('arrow_right.png', 'arrow_right_ghosted.png'));
    } else {
      $('#next img').attr('src', $('#next img').attr('src').replace('_ghosted', ''));
    }    
  }

  var album_size = 0;
  var first_photo = 0;
  var last_photo = 0;
  var currently_sliding = false;
  var num_to_slide = 0;

  //Changing between pictures
  $(function(){
    $('.gallery_image').live('click', function(){
      var img = $(this);
      $('.gallery_image img').removeClass('selected');
      img.find('img').addClass('selected');
      var id = img.attr('rel');
      var width = parseInt($('#photo_width_' + id).html());
      var height = parseInt($('#photo_height_' + id).html());
            
      $('#large_image').html('');
      if ($('#photo_data_' + id).html().replace(/\s*/, '') != '') {
        $('#large_image').append(
          $(document.createElement('div'))
            .attr('class', 'description')
            .append(
              $(document.createElement('p')).html($('#photo_data_' + id).html())
            )
          );
      }        
      $('#large_image').append($(document.createElement('img')).attr('src', $('#photo_filename_' + id).html()).css({ width: width, height: height }));
      $('#large_image').find('img').css('margin-top', (parseInt($('#large_image').css('height')) - height) / 2);
    });
  });
  
  //Changing between albums
  $(function() {
    $('.album').click(function() {
      <%= remote_function(:url => { :action => 'album'}, :with => "'id=' + $(this).attr('rel')", :update => 'thumbs') %>
    });
  });

  //Sliding thumbnails     
  $('#next').live('click', function() {
    if (currently_sliding) {
      return false;
    }
    var position = parseInt($('.thumb_holder').find('.thumbs').css("left"));
    if (last_photo < album_size) {
      currently_sliding = true;
      num_to_slide = Math.min(13, album_size - last_photo);
      $(".thumb_holder").find('.thumbs').animate(
        { left: position - num_to_slide * 57 },
        1500,
        function() {
          currently_sliding = false;
        }
      );
      first_photo = first_photo + num_to_slide;
      last_photo = last_photo + num_to_slide;
    }
    set_button_states();
    return false;
  });
  
  $('#previous').live('click', function() { 
    if (currently_sliding) {
      return false;
    }
    var position = parseInt($('.thumb_holder').find('.thumbs').css("left"));
    if (first_photo > 1) {
      currently_sliding = true;
      num_to_slide = Math.min(13, first_photo-1);
      $(".thumb_holder").find('.thumbs').animate(
        { left: position + num_to_slide * 57 },
        1500,
        function() {
          currently_sliding = false;
        }
      );
      first_photo = first_photo - num_to_slide;
      last_photo = last_photo - num_to_slide;
    }
    
    set_button_states();
    return false;
  });

  
  //Large image hover text
  // $(function(){
  //   $('#large_image').hover(function(){
  //      $('.description').slideDown("medium");
  //    },
  //    function() {
  //      $('.description').slideUp("medium");      
  //    });
  // });   
</script>

<div id="wrapper">
  <div id="large_image">
    <% if @albums.first && first_photo = @albums.first.photos.first %>
      <div class="description"><p><%= first_photo.title %>&nbsp;<%= first_photo.description %></p></div>
      <%= image_tag(first_photo.public_filename) %>
    <% end %>
  </div>

  <div id="menu"> 
    <%= image_tag('gallery_up_ghosted.png', :alt => 'up') %>    
    <% @albums.each_with_index do |album, i| %>
      <div class = "album" <%= i >= num_albums_at_once ? 'style = "display: block"' : '' %> rel = "<%= album.id %>">
        <a href = "#"><%= image_tag(album.cover_photo_url) %></a>
      </div>
    <% end %>   
    <%= image_tag('gallery_down_ghosted.png', :alt => 'down') %>
  </div>
</div>

<%= render :partial => 'album', :object => @albums.first %>